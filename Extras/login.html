<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MOM - Login</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="login.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header>
      <div class="header-container">
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-heart"></i>
          </div>
          <div class="logo-text">MOM</div>
          <span class="logo-tagline">Your Postpartum Care Companion</span>
        </div>
        <ul class="nav-links" style="margin-left: auto; margin-right: 20px">
          <li><a href="./home.html">Home</a></li>
        </ul>
      </div>
      <div class="header-bubbles">
        <div
          class="bubble"
          style="width: 30px; height: 30px; left: 10%; animation-duration: 12s"
        ></div>
        <div
          class="bubble"
          style="
            width: 20px;
            height: 20px;
            left: 20%;
            animation-duration: 15s;
            animation-delay: 2s;
          "
        ></div>
        <div
          class="bubble"
          style="
            width: 25px;
            height: 25px;
            left: 40%;
            animation-duration: 18s;
            animation-delay: 1s;
          "
        ></div>
        <div
          class="bubble"
          style="
            width: 35px;
            height: 35px;
            left: 65%;
            animation-duration: 14s;
            animation-delay: 3s;
          "
        ></div>
        <div
          class="bubble"
          style="
            width: 22px;
            height: 22px;
            left: 85%;
            animation-duration: 16s;
            animation-delay: 4s;
          "
        ></div>
      </div>
    </header>

    <!-- Main Content -->
    <main>
      <div class="auth-container">
        <div class="auth-card">
          <div class="auth-header">
            <h2>Welcome Back</h2>
            <p>Sign in to access your personal care assistant</p>
          </div>
          <div class="auth-form-container">
            <form id="login-form" class="auth-form">
              <div class="form-group">
                <label for="email">Email</label>
                <div class="input-with-icon">
                  <i class="fas fa-envelope"></i>
                  <input
                    type="email"
                    id="email"
                    name="email"
                    placeholder="Enter your email"
                    required
                  />
                </div>
                <div class="error-message" id="email-error"></div>
              </div>
              <div class="form-group">
                <label for="password">Password</label>
                <div class="input-with-icon">
                  <i class="fas fa-lock"></i>
                  <input
                    type="password"
                    id="password"
                    name="password"
                    placeholder="Enter your password"
                    required
                  />
                </div>
                <div class="error-message" id="password-error"></div>
              </div>
              <div class="form-options">
                <div class="remember-me">
                  <input type="checkbox" id="remember" name="remember" />
                  <label for="remember">Remember me</label>
                </div>
                <a href="#" class="forgot-password">Forgot Password?</a>
              </div>
              <div
                class="error-message"
                id="login-error"
                style="color: red; margin-top: 10px; font-size: 0.9rem"
              ></div>
              <button type="submit" class="auth-button">
                <span>Sign In</span>
                <i class="fas fa-arrow-right"></i>
              </button>
            </form>
          </div>
          <div class="auth-footer">
            <p>Don't have an account? <a href="signup.html">Sign Up</a></p>
          </div>
        </div>
        <div class="auth-info">
          <div class="auth-info-content">
            <h2>Your Postpartum Journey Matters</h2>
            <p>
              Join our community of mothers and get personalized support through
              every step of your postpartum experience.
            </p>
            <ul class="benefits-list">
              <li>
                <i class="fas fa-check-circle"></i>
                <span>24/7 access to personalized care guidance</span>
              </li>
              <li>
                <i class="fas fa-check-circle"></i>
                <span>Expert resources for maternal wellness</span>
              </li>
              <li>
                <i class="fas fa-check-circle"></i>
                <span>Supportive community of mothers</span>
              </li>
              <li>
                <i class="fas fa-check-circle"></i>
                <span>Track your postpartum recovery progress</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer>
      <div class="footer-content">
        <div class="footer-about">
          <h3>MOM</h3>
          <p>
            We're dedicated to supporting new parents through their postpartum
            journey with compassion, evidence-based information, and
            personalized guidance.
          </p>
          <div class="social-links">
            <a href="#" class="social-link" aria-label="Facebook"
              ><i class="fab fa-facebook-f"></i
            ></a>
            <a href="#" class="social-link" aria-label="Twitter"
              ><i class="fab fa-twitter"></i
            ></a>
            <a href="#" class="social-link" aria-label="Instagram"
              ><i class="fab fa-instagram"></i
            ></a>
            <a href="#" class="social-link" aria-label="Pinterest"
              ><i class="fab fa-pinterest-p"></i
            ></a>
          </div>
        </div>
        <div class="footer-newsletter">
          <h4>Stay Updated</h4>
          <p>
            Subscribe to our newsletter to receive the latest postpartum care
            tips and resources.
          </p>
          <form class="newsletter-form">
            <input
              type="email"
              placeholder="Your email address"
              aria-label="Email for newsletter"
            />
            <button type="submit" class="newsletter-btn">Subscribe</button>
          </form>
        </div>
      </div>
      <div class="footer-bottom">
        <p>
          &copy; 2025 MOM - Your Postpartum Care Companion. All rights reserved.
        </p>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Redirect if already authenticated
        redirectIfAuthenticated();

        // Handle form submission
        const loginForm = document.getElementById("login-form");
        const errorContainer = document.getElementById("login-error");

        if (loginForm) {
          loginForm.addEventListener("submit", async function (e) {
            e.preventDefault();

            // Clear previous errors
            errorContainer.textContent = "";
            errorContainer.style.display = "none";
            errorContainer.style.color = "red";

            // Get form inputs
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            const remember = document.getElementById("remember").checked;

            // Validate form
            if (!email || !password) {
              errorContainer.textContent =
                "Please enter your email and password";
              errorContainer.style.display = "block";
              return;
            }

            try {
              // Show loading state
              const submitButton = loginForm.querySelector(
                'button[type="submit"]'
              );
              const originalButtonText = submitButton.innerHTML;
              submitButton.disabled = true;
              submitButton.innerHTML =
                '<span>Logging in...</span> <i class="fas fa-spinner fa-spin"></i>';

              // Login user with API
              const response = await loginUser({ email, password, remember });

              if (response.token) {
                // Store token and user data
                localStorage.setItem("token", response.token);
                localStorage.setItem("user", JSON.stringify(response.user));

                // Show success message
                errorContainer.textContent = "Login successful! Redirecting...";
                errorContainer.style.display = "block";
                errorContainer.style.color = "green";

                // Redirect to home page
                setTimeout(() => {
                  window.location.href = "/home.html";
                }, 1000);
              } else {
                // Display error message
                errorContainer.textContent =
                  response.message ||
                  response.msg ||
                  "Login failed. Please try again.";
                errorContainer.style.display = "block";

                // Reset button
                submitButton.disabled = false;
                submitButton.innerHTML = originalButtonText;
              }
            } catch (error) {
              console.error("Login error in form handler:", error);

              // Display error message with more details
              let errorMessage = "Login failed: ";

              if (error.message && error.message.includes("fetch")) {
                errorMessage +=
                  "Could not connect to server. Please check your internet connection.";
              } else if (error.message) {
                errorMessage += error.message;
              } else {
                errorMessage +=
                  "Unknown error occurred. Please try again later.";
              }

              errorContainer.textContent = errorMessage;
              errorContainer.style.display = "block";

              // Reset button
              const submitButton = loginForm.querySelector(
                'button[type="submit"]'
              );
              submitButton.disabled = false;
              submitButton.innerHTML = originalButtonText;
            }
          });
        }

        // Check for expired session parameter
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get("expired") === "true") {
          errorContainer.textContent =
            "Your session has expired. Please log in again.";
          errorContainer.style.display = "block";
        }

        // Create bubbles for the header animation
        const createBubbles = () => {
          const headerBubbles = document.querySelector(".header-bubbles");
          if (!headerBubbles) return;

          for (let i = 0; i < 10; i++) {
            const bubble = document.createElement("div");
            bubble.classList.add("bubble");

            // Random size
            const size = Math.random() * 50 + 20;
            bubble.style.width = `${size}px`;
            bubble.style.height = `${size}px`;

            // Random position
            bubble.style.left = `${Math.random() * 100}%`;

            // Random delay and duration
            bubble.style.animationDelay = `${Math.random() * 5}s`;
            bubble.style.animationDuration = `${Math.random() * 10 + 10}s`;

            headerBubbles.appendChild(bubble);
          }
        };

        createBubbles();
      });
    </script>
  </body>
</html>
